server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # ===========================================
  # --- Compression : Gzip uniquement ---
  # ===========================================
  gzip on;
  gzip_comp_level 6;
  gzip_types text/plain text/css application/javascript application/json image/svg+xml application/xml+rss;
  gzip_min_length 1024;
  gzip_vary on;

  # ===========================================
  # --- Cache des fichiers statiques ---
  # ===========================================
  location ~* \.(?:js|css|png|jpg|jpeg|gif|svg|ico|woff2?)$ {
      expires 1y;
      add_header Cache-Control "public, max-age=31536000, immutable";
      access_log off;
      try_files $uri =404;
  }

  # ===========================================
  # --- Cache court pour index.html (SPA) ---
  # ===========================================
  location = /index.html {
      add_header Cache-Control "no-cache, no-store, must-revalidate";
      expires off;
  }

  # ===========================================
  # --- Routes SPA : renvoyer index.html ---
  # ===========================================
  location / {
      # Bloquer les .jsx si jamais expos√©s
      if ($uri ~* \.jsx$) {
          return 404;
      }
      try_files $uri $uri/ /index.html;
  }

  # ===========================================
  # --- Proxy vers API backend ---
  # ===========================================
  location /api/ {
          return 403;
      }

  # ===========================================
  # --- Logs ---
  # ===========================================
  access_log /var/log/nginx/access.log;
  error_log /var/log/nginx/error.log;
}
